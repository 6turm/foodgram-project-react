# Foodgram - продуктовый помощник
http://178.154.193.194/

Данные superuser:  
логин: admin  
пароль: admin


Продуктовый помощник - сайт с рецептами. Авторы публикуют рецепты, могут добавлять рецепты в избранное, подписываться на авторов, добавлять рецепты в список покупок и на его основе скачивать список для похода в магазин.

Проект является дипломной работой в рамках курса Python-разработчик от Яндекс Практикума.
Фронтенд для проекта предоставлен Яндекс Практикумом.


### Особенности деплоя:
Деплой проекта осуществляется автоматически на основании GitHub Workflow. При внесении изменений в репозеторий (push) автоматически выполняются следующие действия:
* Запускаются автоматические тесты (в настоящий момент это проверка соответсвия кода стандарту PEP8).
* В случае успешного прохождения тестов создается обновленный docker-образ с тегом `:latest`, который заливается на Docker-Hub.
* Происходит деплой на сервер: с DockerHub выкачивается обновленный образ и разворачивается на сервере.
* Приходит уведомление в телеграм об успешном завершении текущего workflow.



## Установка проекта на удаленный сервер
Разворачивание проекта на сервере осуществляется посредстом Docker и Docker-Compose, их необходимо установить на ваш сервер.
Установка Docker: https://docs.docker.com/engine/install/ubuntu/
Установка Docker-Compose: https://docs.docker.com/compose/install/

### Шаг 1
Подготовьте `.env` файл с переменными окружения для вашего проекта:

```
SECRET_KEY=your_cecret_cey  # Секретный ключ django (создайте свой уникальный ключ)
DB_ENGINE=django.db.backends.postgresql  # Бэкенд django (менять не следует)
POSTGRES_DB=postgres  # Наименование базы данных
POSTGRES_USER=postgres  # Имя пользователя для взаимодействия с базой данных
POSTGRES_PASSWORD=posrgrespassword  # Пароль пользователся базы данных
DB_HOST=db  # Название сервиса (контейнера)
DB_PORT=5432  # Порт для взаимодействия с базой данных
```

### Шаг 2

Создайте на сервере директорию `~/foodgram_code` и поместите в нее созданный `.env` файл 

### Шаг 3
Сделайте fork текущего репозитория на GitHub.

### Шаг 4
Создайте секреты  ([secrets](https://docs.github.com/en/actions/reference/encrypted-secrets)) репозитория на GitHub со следующими переменными:

```
DOCKER_PASSWORD  # Ваш пароль на DockerHub
DOCKER_USERNAME  # Ваш логин на DockerHub
HOST  # Публичный ip адрес сервера
USER  # Имя пользователя для доступа на сервер
SSH_KEY # Приватный ssh-ключ для доступа на сервер
PASSPHRASE # Пароль для ssh-ключа
TELEGRAM_TO # ID телеграм-аккаунта
TELEGRAM_TOKEN # Токен бота
```
Если вы не хотите использовать уведомления в телеграм, следует удалить из файла `/.github/workflows/main.yml` вашего репозитория последний этап (job) 'send_message'.
В этом случае можно не создавать секреты `TELEGRAM_TO` и `TELEGRAM_TOKEN`.


### Шаг 5

Запустите выполнение скрипта workflow, для этого можно запушить любое изменение любого файла.
Дождитесь успешного завершения выполнения скрипта.

### Шаг 6
На сервере выполните команду для выполнения миграций базы данных:
```
sudo docker-compose run web python manage.py migrate
```

### Шаг 7
Соберите статику:

```
sudo docker-compose exec web python manage.py collectstatic --no-input
```

### Шаг 8
Наполните базу первоначальными данными:

```
# загрузить в базу продукты (процесс может занимать несколько минут)
sudo docker-compose exec web python manage.py load_products

# создать первоначальные теги
sudo docker-compose exec web python manage.py create_tags
```

### Шаг 9
Создайте суперпользователя базы данных:

```
sudo docker-compose run web python manage.py createsuperuser
```
админка доступна по адресу http://<your_server_ip>/admin/




## Бейдж GitHub Workflow
![main](https://github.com/6turm/foodgram-project-react/actions/workflows/main.yml/badge.svg)
